{"ts":1342110949876,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var sip = require('sip');\nvar digest = require('sip/digest');\n\nvar mysipport = process.env.PORT;\n//mysipport =  5080;\n\n//mysipport = process.env.C9_PORT;\nvar myhost = 'gapps_script_shared.tsschnoc.c9.io';\nmyhost = 'project-livec95140114411.rhcloud.com';\nmysipport =  '80';\n//myhost = process.env.IP;\n//myhost = '23.21.127.234';\n//myhost = 'home.schnocklake.de';\n\n\n\n  console.log(myhost);\n  console.log(mysipport);\n\n\nvar uri = 'sip:0435009722.320@sip12.e-fon.ch';\nvar cred = {\n  user: '0435009722.320',\n  password: 'parxwerk123',\n  realm: 'e-fon.ch'\n};\n\n\nvar uri = 'sip:1835084@sipgate.de';\nvar cred = {\n  user: '1835084',\n  password: 'AUPSSZ',\n  realm: 'sipgate.de'\n};\n\n\n//http://level7systems.co.uk/en/blog/Click+to+Call+with+PHP-SIP\n\nvar authReg = {\n    method: 'REGISTER',\n    uri: uri,\n    headers: {\n      to: {\n        uri: uri\n      },\n      from: {\n        uri: uri,\n        params: {\n          tag: '12345678'\n        }\n      },\n      'call-id': Math.floor(Math.random() * 1e6),\n      cseq: {\n        method: 'REGISTER',\n        seq: 1\n      },\n      event: 'dialog',\n      accept: 'application/dialog-info+xml',\n      expires: 3600,\n      contact: [{\n        uri: 'sip:' + myhost + ':' + mysipport\n      }]\n    }\n  };\n  \n  \nconsole.log(authReg);\nconsole.log(authReg.headers.contact);\n\n\nsip.start({\n  port: process.env.C9_PORT,\n  logger: {\n//    recv: console.log,\n//    send: console.log\n  }\n}, function(rq) {\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log(rq);\n  console.log(rq.headers);\n  \n  if(rq.method === 'INVITE') {\n//    sip.send(sip.makeResponse(rq, 100, 'Trying'));\n    sip.send(sip.makeResponse(rq, 180, 'Ringing'));\n  }\n    \n});\n\nregister();\n\n\nfunction register() {\n  sip.send(authReg, function(rs) {\n    console.log('CCCCCCCCCCCCC response on register CCCCCCCCCCCCCCCC');\n    console.log(rs);    \n\n    if(rs.status === 401)  //reason Unauthorized\n    {  \n    console.log('CyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyC' + cred.realm);\n    console.log('CyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyC' + JSON.stringify(rs.headers[\"www-authenticate\"]));\n    console.log('CyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyC' + JSON.stringify(rs.headers[\"www-authenticate\"][\"realm\"]));\n\n      digest.signRequest({\n        realm: cred.realm\n      }, authReg, rs, cred);\n\n\n    console.log('CyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyC');\n    console.log(authReg);    \n      \n      register();\n    } else if(rs.status === 200)  //reason OK\n    {\n      console.log('------------------------REGISTERED------------------------------------');\n    }\n  \n  });\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":2837}]],"length":2837}
