{"ts":1340568439344,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var sip = require('sip');\nvar digest = require('sip/digest');\n\n\nvar uri = 'sip:1835084@sipgate.de';\n\nvar cred = {\n  user: '1835084',\n  password: 'AUPSSZ',\n  realm: 'sipgate.de'\n};\n\n\n//http://level7systems.co.uk/en/blog/Click+to+Call+with+PHP-SIP\n\nvar authReg = {\n    method: 'REGISTER',\n    uri: uri,\n    headers: {\n      to: {\n        uri: uri\n      },\n      from: {\n        uri: uri,\n        params: {\n          tag: '12345678'\n        }\n      },\n      'call-id': Math.floor(Math.random() * 1e6),\n      cseq: {\n        method: 'REGISTER',\n        seq: 1\n      },\n      event: 'dialog',\n      accept: 'application/dialog-info+xml',\n      expires: 3600,\n      contact: [{\n        uri: 'sip:gapps_script_shared.tsschnoc.c9.io:' + process.env.C9_PORT\n      }]\n    }\n  };\n  \n  \n\n\n\nsip.start({\n  port: process.env.C9_PORT,\n  logger: {\n//    recv: console.log,\n//    send: console.log\n  }\n}, function(rq) {\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log(rq);\n  console.log(rq.headers);\n  \n  if(rq.method === 'INVITE') {\n//    sip.send(sip.makeResponse(rq, 100, 'Trying'));\n    sip.send(sip.makeResponse(rq, 180, 'Ringing'));\n  }\n    \n});\n\nregister();\n\n\nfunction register() {\n  sip.send(authReg, function(rs) {\n    console.log('CCCCCCCCCCCCC response on register CCCCCCCCCCCCCCCC');\n    console.log(rs);    \n\n    if(rs.status === 401)  //reason Unauthorized\n    {  \n      digest.signRequest({\n        realm: 'sipgate.de'\n      }, authReg, rs, cred);\n      \n      register();\n    } else if(rs.status === 200)  //reason OK\n    {\n      console.log('------------------------REGISTERED------------------------------------');\n    }\n  \n  });\n}\n\n\n"]],"start1":0,"start2":0,"length1":0,"length2":1942}]],"length":1942}
