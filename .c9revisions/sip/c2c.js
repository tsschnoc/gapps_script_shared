{"ts":1340568438890,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var from = 'sip:1835084@sipgate.de';\nvar from2 = 'sip:091130835084@sipgate.de';\nvar to = 'sip:004123423423424324@sipgate.de';\n\n\nvar sip = require('sip');\nvar digest = require('sip/digest');\n\nvar uri = 'sip:1835084@sipgate.de';\n\nvar cred = {\n  user: '1835084',\n  password: 'AUPSSZ',\n  realm: 'sipgate.de'\n};\n\n\n//http://level7systems.co.uk/en/blog/Click+to+Call+with+PHP-SIP\n\nvar authReg = {\n    method: 'INVITE',\n    uri: from2,\n    headers: {\n      to: {\n        uri: from2\n      },\n      from: {\n        Name: from2,\n        uri: from,\n        params: {\n          tag: '12345678'\n        }\n      },\n      'call-id': Math.floor(Math.random() * 1e6),\n      cseq: {\n        method: 'INVITE',\n        seq: 1\n      },\n      event: 'dialog',\n      accept: 'application/dialog-info+xml',\n      expires: 3600,\n      contact: [{\n        uri: 'sip:gapps_script_shared.tsschnoc.c9.io:' + process.env.C9_PORT\n      }]\n    \n    },\n      content:\n    'v=0\\r\\n'+\n    'o=- 13374 13374 IN IP4 172.16.2.2\\r\\n'+\n    's=-\\r\\n'+\n    'c=IN IP4 172.16.2.2\\r\\n'+\n    't=0 0\\r\\n'+\n    'm=audio 16424 RTP/AVP 0 8 101\\r\\n'+\n    'a=rtpmap:0 PCMU/8000\\r\\n'+\n    'a=rtpmap:8 PCMA/8000\\r\\n'+\n    'a=rtpmap:101 telephone-event/8000\\r\\n'+\n    'a=fmtp:101 0-15\\r\\n'+\n    'a=ptime:30\\r\\n'+\n    'a=sendrecv\\r\\n'\n  };\n  \n  \n\n\n\nsip.start({\n  port: process.env.C9_PORT,\n  logger: {\n//    recv: console.log,\n//    send: console.log\n  }\n}, function(rq) {\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log(rq);\n  console.log(rq.headers);\n  \n  if(rq.method === 'INVITE') {\n//    sip.send(sip.makeResponse(rq, 100, 'Trying'));\n    sip.send(sip.makeResponse(rq, 180, 'Ringing'));\n  }\n    \n});\n\nregister();\n\n\nfunction register() {\n  \n  console.log(authReg);\n  \n  \n  sip.send(authReg, function(rs) {\n    console.log('CCCCCCCCCCCCC response on register CCCCCCCCCCCCCCCC');\n    console.log(rs);    \n    //console.log(rs.headers);    \n\n    if(rs.status === 407)  //reason Unauthorized\n    {  \n      digest.signRequest({\n        realm: 'sipgate.de'\n      }, authReg, rs, cred);\n      \n      register();\n    } else if(rs.status === 200)  //reason OK\n    {\n      console.log('------------------------REGISTERED------------------------------------');\n    }\n  \n  });\n}\n\n\n"]],"start1":0,"start2":0,"length1":0,"length2":2523}]],"length":2523}
