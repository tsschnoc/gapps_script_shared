{"ts":1357572377157,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":true,"ts":1357572428923,"patch":[[{"diffs":[[1,"<?\r\n// Licht & Strom \r\n// Web-Schaltapplikation fuer ConnAir   \r\n// Version 0.1 (24.11.2012)\r\n// unterst端tzte Steckdosen\r\n// - brennstuhl RCS 1000N (Version 1: ca. 2009, Version 2: 2012)\r\n// - intertechno PAR-1000 (Version 1: ca 2006)\r\n\r\n\r\n// Konfiguration\r\n// **************\r\n//\r\n// Array mit Konfigurationsdaten\r\n// Format: \r\n// [Hersteller]-[Master]-[Slave]-[Version]\r\n// Hersteller (i = intertechno, b = brennstuhl)\r\n// f端r brennstuhl RCS 1000N:\r\n//    dip switches 12345-ABCDE zB. \r\n//     b-10010-00100-1 => Brennstuhl, 12345 (Master) = 10010, ABCDE (Slave) = 00100 (==C), Version = 1\r\n//      version 1=brennstuhl 2009,  2=brennstuhl 2012\r\n// f端r intertechno PAR-1000, Master A-D, Slave 1-3, zB. \r\n//      i-C-2-1 f端r intertechno Steckdose mit Code C2\r\n//      version = 1 (andere habe ich nicht)\r\n\r\n\r\n$steckdose = array(\r\n   \"Licht 1 Wohnzimmer\" => \"b-10011-00100-1\", \r\n   \"Licht 2 Wohnzimmer\" => \"b-10011-01000-1\",\r\n   \"Licht 3 Wohnzimmer\" => \"b-10011-10000-1\", \r\n   \"Licht 1 Arbeitszimmer\" => \"i-A-1-1\",  \r\n   \"Licht 2 Arbeitszimmer \" => \"i-A-2-1\",    \r\n   \"Licht 3 Arbeitszimmer\" => \"i-A-3-1\",\r\n   \"Strom PC\" => \"b-10111-01000-2\",\r\n   \"Strom Drucker\" => \"b-10111-00100-2\",\r\n   \"Strom TV\" => \"b-10111-10000-2\"\r\n    );\r\n    \r\n\r\n$errormessage=\"\";\r\n   \r\n\r\nfunction connair_send($msg)\r\n{\r\n   // IP Adresse ConnAir\r\n   $IP=\"192.168.123.100\";\r\n   $PORT=49880;\r\n   \r\n   $sock = socket_create(AF_INET, SOCK_DGRAM, SOL_UDP);\r\n   $len = strlen($msg);\r\n\r\n   if($sock) {\r\n      socket_sendto($sock, $msg, $len, 0, $IP, $PORT);\r\n      socket_close($sock);\r\n   }\r\n   else {\r\n      $errormessage= \"Kann ConnAir nicht erreichen IP:PORT=\".$IP.\":\".$PORT.\"\\n\";\r\n   }\r\n      \r\n}\r\n\r\n\r\nfunction tx433_brennstuhl($Master,$Slave,$onoff,$tx433version)\r\n{   \r\n   $sA=0;\r\n   $sG=0;\r\n   $sRepeat=10;\r\n   $sPause=5600;\r\n   $sTune=350;\r\n   $sBaud=25;\r\n   $sSpeed=16;\r\n   \r\n   $uSleep=800000;\r\n   if ($tx433version==1) $txversion=3;\r\n   else $txversion=1;\r\n   \r\n   $HEAD=\"TXP:$sA,$sG,$sRepeat,$sPause,$sTune,$sBaud,\";\r\n   $TAIL=\",$txversion,1,$sSpeed,;\";\r\n   $AN=\"1,3,1,3,3\";\r\n   $AUS=\"3,1,1,3,1\";\r\n   \r\n   $bitLow=1;\r\n   $bitHgh=3;\r\n   \r\n   $seqLow=$bitHgh.\",\".$bitHgh.\",\".$bitLow.\",\".$bitLow.\",\";\r\n   $seqHgh=$bitHgh.\",\".$bitLow.\",\".$bitHgh.\",\".$bitLow.\",\";\r\n\r\n   $bits=$Master;\r\n   $msg=\"\";\r\n   for($i=0;$i<strlen($bits);$i++) {   \r\n      $bit=substr($bits,$i,1);\r\n      if($bit==\"0\")\r\n         $msg=$msg.$seqLow;\r\n      else\r\n         $msg=$msg.$seqHgh;\r\n   }\r\n   $msgM=$msg;\r\n   $bits=$Slave;\r\n   $msg=\"\";\r\n   for($i=0;$i<strlen($bits);$i++) {\r\n      $bit=substr($bits,$i,1);\r\n      if($bit==\"0\")\r\n         $msg=$msg.$seqLow;\r\n      else\r\n         $msg=$msg.$seqHgh;\r\n   }\r\n\r\n   $msgS=$msg;\r\n   $msg_ON=$HEAD.$bitLow.\",\".$msgM.$msgS.$bitHgh.\",\".$AN.$TAIL;\r\n   $msg_OFF=$HEAD.$bitLow.\",\".$msgM.$msgS.$bitHgh.\",\".$AUS.$TAIL;\r\n   \r\n   if($onoff==1){ $msg=$msg_ON;}\r\n   else $msg=$msg_OFF;\r\n   connair_send($msg);\r\n}   \r\n\r\nfunction tx433_intertechno($Master,$Slave,$onoff,$tx433version)\r\n{\r\n   $sA=0;\r\n   $sG=0;\r\n   $sRepeat=6;\r\n   $sPause=11125;\r\n   $sTune=89;\r\n   $sBaud=25;\r\n   $sSpeed=125;\r\n   \r\n   $uSleep=800000;\r\n   \r\n   $HEAD=\"TXP:$sA,$sG,$sRepeat,$sPause,$sTune,$sBaud,\";\r\n   $TAIL=\",1,$sSpeed,;\";\r\n   $AN=\"12,4,4,12,12,4\";\r\n   $AUS=\"12,4,4,12,4,12\";\r\n   \r\n   $bitLow=4;\r\n   $bitHgh=12;\r\n   \r\n   $seqLow=$bitHgh.\",\".$bitHgh.\",\".$bitLow.\",\".$bitLow.\",\"; \r\n   $seqHgh=$bitHgh.\",\".$bitLow.\",\".$bitHgh.\",\".$bitLow.\",\";\r\n   \r\n   $msgM=\"\";\r\n\r\n   switch ($Master){\r\n      case \"A\":\r\n         $msgM=$seqHgh.$seqHgh.$seqHgh;\r\n         break;\r\n      case \"B\":\r\n         $msgM=$seqLow.$seqHgh.$seqHgh;\r\n         break;    \r\n      case \"C\":\r\n         $msgM=$seqHgh.$seqLow.$seqHgh;\r\n         break;  \r\n      case \"D\":\r\n         $msgM=$seqLow.$seqLow.$seqHgh;\r\n         break;\r\n   }\r\n\r\n   $msgS=\"\";   \r\n   switch ($Slave){\r\n      case \"1\":\r\n         $msgS=$seqHgh.$seqHgh.$seqHgh;\r\n         break;\r\n      case \"2\":\r\n         $msgS=$seqHgh.$seqLow.$seqHgh;\r\n         break;    \r\n      case \"3\":\r\n         $msgS=$seqHgh.$seqHgh.$seqLow;\r\n         break;  \r\n   }\r\n   \r\n   $msg_ON=$HEAD.$bitLow.\",\".$msgM.$msgS.$seqHgh.$seqHgh.$seqHgh.$seqLow.$bitHgh.\",\".$AN.$TAIL;\r\n   $msg_OFF=$HEAD.$bitLow.\",\".$msgM.$msgS.$seqHgh.$seqHgh.$seqHgh.$seqLow.$bitHgh.\",\".$AUS.$TAIL;\r\n   \r\n   if($onoff==1){ $msg=$msg_ON;}\r\n   else $msg=$msg_OFF;\r\n   connair_send($msg);\r\n}   \r\n\r\n\r\n// main\r\n\r\nif (isset($_POST['submit']))\r\n{\r\n   if (($_POST['submit'])==\"submit_on\") { $setaction=1; }\r\n   else { $setaction=0;}\r\n         \r\n   if ($_POST['vendor']==\"b\")\r\n   {\r\n      tx433_brennstuhl($_POST['master'],$_POST['slave'],$setaction, $_POST['version']);\r\n   }\r\n   if ($_POST['vendor']==\"i\")\r\n   {\r\n      tx433_intertechno($_POST['master'],$_POST['slave'],$setaction, $_POST['version']);\r\n   }\r\n}\r\n\r\n\r\n// alles aus\r\nif (isset($_POST['allesaus']))\r\n{\r\n   foreach ($steckdose as $i => $value) {\r\n         $vendorcode=substr($value, 0,1);\r\n         switch ($vendorcode){\r\n            case \"i\":\r\n               $masterdip=substr($value, 2, 1);\r\n               $slavedip=substr($value, 4, 1);\r\n               $tx433version=substr($value, 6, 1);\r\n               break;\r\n            case \"b\";\r\n               $masterdip=substr($value, 2, 5);\r\n               $slavedip=substr($value, 8, 5);\r\n               $tx433version=substr($value, 14, 1);\r\n               break;\r\n            // more vendors to add..\r\n         }      \r\n         $setaction=0;\r\n         // wenn brennstuhl\r\n         if ($vendorcode==\"b\")\r\n            {\r\n               tx433_brennstuhl($masterdip,$slavedip,$setaction,$tx433version);\r\n            }\r\n         // wenn intertechno\r\n         if ($vendorcode==\"i\")\r\n            {\r\n               tx433_intertechno($masterdip,$slavedip,$setaction);\r\n            }\r\n         sleep (1);\r\n         }\r\n\r\n}\r\n\r\n\r\n?>\r\n<!DOCTYPE html> \r\n<html> \r\n<head> \r\n   <title>Licht &amp; Strom</title> \r\n   <link rel=\"stylesheet\" href=\"http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css\" />\r\n   <script src=\"http://code.jquery.com/jquery-1.8.2.min.js\"></script>\r\n   <script src=\"http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js\"></script>\r\n   <meta name=\"viewport\" content=\"320.1, initial-scale=1.0\">\r\n   <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\r\n</head> \r\n</head> \r\n<body> \r\n\r\n<div data-role=\"page\">\r\n\r\n   <div data-role=\"header\">\r\n      <h1>Licht &amp; Strom</h1>\r\n   </div><!-- /header -->\r\n\r\n   <div data-role=\"content\" align=\"center\">   \r\n      <div data-role=\"collapsible-set\">\r\n   <?\r\n      foreach ($steckdose as $i => $value) {\r\n      $vendorcode=substr($value, 0,1);\r\n      switch ($vendorcode){\r\n         case \"i\":\r\n            $masterdip=substr($value, 2, 1);\r\n            $slavedip=substr($value, 4, 1);\r\n            $tx433version=substr($value, 6, 1);\r\n            break;\r\n         case \"b\";\r\n            $masterdip=substr($value, 2, 5);\r\n            $slavedip=substr($value, 8, 5);\r\n            $tx433version=substr($value, 14, 1);\r\n            break;\r\n         // more vendors to add..\r\n      }      \r\n   \r\n      \r\n   ?>\r\n      <div data-role=\"collapsible\" data-theme=\"a\" data-content-theme=\"d\">\r\n         <h3><? echo $i; ?></h3>\r\n         <p>\r\n         <form action=\"<? echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" data-ajax=\"false\">\r\n            <button type=\"submit\" name=\"submit\" value=\"submit_on\" data-theme=\"a\" data-icon=\"star\" data-inline=\"true\">Ein</button>\r\n            <button type=\"submit\" name=\"submit\" value=\"submit_off\" data-theme=\"a\" data-icon=\"star\" data-inline=\"true\">Aus</button>\r\n            <input type=\"hidden\" name=\"vendor\" value=\"<? echo $vendorcode; ?>\">\r\n            <input type=\"hidden\" name=\"master\" value=\"<? echo $masterdip; ?>\">\r\n            <input type=\"hidden\" name=\"slave\" value=\"<? echo $slavedip; ?>\">\r\n            <input type=\"hidden\" name=\"version\" value=\"<? echo $tx433version; ?>\">\r\n         </form>\r\n         </p>\r\n      </div>\r\n   <?\r\n   }\r\n   ?>\r\n      </div>\r\n   <br>\r\n   <br>\r\n   <br>\r\n   <br>\r\n   <br>\r\n   <br>\r\n   <br>\r\n   <br>\r\n   \r\n   <div align=\"center\">   \r\n         <form action=\"<? echo $_SERVER['PHP_SELF']; ?>\" method=\"post\" data-ajax=\"false\">\r\n         <button type=\"submit\" name=\"allesaus\" value=\"allesaus\" data-theme=\"b\" data-icon=\"delete\" >Alles aus</button>\r\n      </form>\r\n   </div>\r\n   \r\n   <? echo $errormessage; ?></p>\r\n   </div><!-- /content -->\r\n\r\n</div><!-- /page -->\r\n</body>\r\n</html>"]],"start1":0,"start2":0,"length1":0,"length2":8343}]],"length":8343,"saved":false}
{"ts":1357572850963,"patch":[[{"diffs":[[0,"<?"],[1,"php"],[0,"\r\n// Lic"]],"start1":0,"start2":0,"length1":10,"length2":13},{"diffs":[[0,"set\">\r\n   <?"],[1,"php"],[0,"\r\n      fore"]],"start1":6457,"start2":6457,"length1":24,"length2":27}]],"length":8349,"saved":false}
{"ts":1357572852308,"patch":[[{"diffs":[[0,"  <h3><?"],[1,"php"],[0," echo $i"]],"start1":7102,"start2":7102,"length1":16,"length2":19}]],"length":8352,"saved":false}
{"ts":1357572854280,"patch":[[{"diffs":[[0,"<form action=\"<?"],[1,"php"],[0," echo $_SERVER['"]],"start1":7155,"start2":7155,"length1":32,"length2":35}]],"length":8355,"saved":false}
{"ts":1357572857541,"patch":[[{"diffs":[[0,"r\" value=\"<?"],[1,"php"],[0," echo $vendo"]],"start1":7547,"start2":7547,"length1":24,"length2":27},{"diffs":[[0,"r\" value=\"<?"],[1,"php"],[0," echo $maste"]],"start1":7631,"start2":7631,"length1":24,"length2":27},{"diffs":[[0,"e\" value=\"<?"],[1,"php"],[0," echo $slave"]],"start1":7713,"start2":7713,"length1":24,"length2":27},{"diffs":[[0,"n\" value=\"<?"],[1,"php"],[0," echo $tx433"]],"start1":7796,"start2":7796,"length1":24,"length2":27}]],"length":8367,"saved":false}
{"ts":1357572858190,"patch":[[{"diffs":[[0,">\r\n   <?"],[1,"php"],[0,"\r\n   }\r\n"]],"start1":7882,"start2":7882,"length1":16,"length2":19}]],"length":8370,"saved":false}
{"ts":1357572861005,"patch":[[{"diffs":[[0,"tion=\"<?"],[1,"php"],[0," echo $_"]],"start1":8044,"start2":8044,"length1":16,"length2":19}]],"length":8373,"saved":false}
{"ts":1357572863528,"patch":[[{"diffs":[[0," \r\n   <?"],[1,"php"],[0," echo $e"]],"start1":8268,"start2":8268,"length1":16,"length2":19}]],"length":8376,"saved":false}
