{"ts":1340223670321,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var sip = require('sip');\n\nvar uri = 'sip:1835084@sipgate.de';\n\nvar subscriptions = {};\n  console.log('yyyyyyyyyyyyyyyyyyyyyyyyy');\n\nsip.start({\n  port: process.env.C9_PORT,\n  logger: {\n    recv: console.log,\n    send: console.log\n  }\n},\nfunction(rq) {\n  console.log('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX');\n  console.log(rq);\n  console.log(rq.headers);\n  if(rq.method === 'NOTIFY') {\n    var rs = sip.makeResponse(rq, 200, 'OK');\n    rs.headers['subscription-state'] = 'active';\n    rs.headers.accept = 'application/dialog-info+xml';\n    rs.headers.event = 'dialog';\n    rs.headers['content-length'] = 0;\n    rs.headers.expire = 3600;\n    sip.send(rs);\n  }\n  else\n    sip.send(sip.makeResponse(rq, 405, 'Method Not Allowed'));\n});\n\nsip.send({\n  method: 'REGISTER',\n  uri: uri,\n  headers: {\n    to: {uri: uri},\n    from: {uri: uri, params: {tag: '12345678'}},\n    'call-id': Math.floor(Math.random() * 1e6),\n    cseq: {method: 'REGISTER', seq: 1},\n    event: 'dialog',\n    accept: 'application/dialog-info+xml',\n    expires: 3600,\n    contact: [{uri: 'sip:sipgate.de:5060'}]\n  }\n},\nfunction(rs) {\n  console.log('CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC');\n  console.log(rs.headers);\n    // sending ACK\n    \n    sip.send({\n      method: 'REGISTER',\n      uri: rs.headers.contact[0].uri,\n      headers: {\n        to: rs.headers.to,\n        from: rs.headers.from,\n        'call-id': rs.headers['call-id'],\n        cseq: {method: 'REGISTER', seq: rs.headers.cseq.seq},\n        via: []\n      }\n    },function(rs1) {\n  console.log(rs1);\n});\n  console.log('AAAAAAAAAAAAAAAAAAAAAAAAA');\n    \n});\n\n"]],"start1":0,"start2":0,"length1":0,"length2":1586}]],"length":1586}
